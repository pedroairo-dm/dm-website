---
layout: post
title: CRM 2015 - New Features - Write form scripts that interact with business process
  flows
date: 2015-02-08 09:47:00.000000000 +00:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- CRM 2015
tags:
- New Features
meta:
  _publicize_pending: '1'
  sharing_disabled: '1'
  _import_session_id: 61e12c43ccaa7
  _import_original_post_id: '54029'
author:
  login: pedroairo
  email: pedroairo@dynamicsmonster.com
  display_name: pedroairo
  first_name: ''
  last_name: ''
permalink: "/2015/02/08/crm-2015-new-features-write-form-scripts-that-interact-with-business-process-flows/"
---
<div>
<div>
<div>
<p style="line-height:18px;padding-bottom:15px;"><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">Some times we need to extend further the product, here is a good example for doing that, interacting with the business process flow with JavaScript.<br /></font><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">Read the text below.<br /></font><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">In this release, business process flows have been enhanced to support branches based on conditions. These conditions take advantage of the newly introduced support for If-Else structures as well as support for combining multiple conditional expressions entirely using <b>OR</b> or <b>AND</b>. With these new capabilities, developers should evaluate whether existing processes that use form scripts could instead use business process flows so that organizations can maintain the logic they need without writing code.<br /></font><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">This release also makes it easier for developers to interact with the business process flows in their scripts. Form script developers have asked for a supported way to interact with the business process form user interface (UI) in form scripts. This release provides a client-side object model developers can use to interact with business process flows in their form scripts. The <b>Xrm.Page</b> object model is extended to include new events, methods, and objects.</font><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);"><br /></font><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">With Microsoft Dynamics CRM 2015 and Microsoft Dynamics CRM Online 2015 Update there is a client-side object you can use to interact with business process flows in your scripts. The <b>Xrm.Page.data</b> namespace is extended to include methods under <b>Xrm.Page.data.process</b>. The <b>Xrm.Page.ui</b> namespace is extended to include methods under<b>Xrm.Page.ui.process</b>.</font><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);"><br /></font><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">Structure of business process flows<br /></font><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">Business process flows consist of a series of stages, each containing a number of steps. Only one stage is the active stage. When the required steps in each stage are complete, the process can move on to the next stage and it becomes the active stage. Which stage is next can be defined based on conditions in the business process flow as shown in the following diagram.<br /></font><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);"><img alt="Business Process Flow Objects" id="d4003cde-97c2-4a69-861e-1ba60ac8840e" src="{{ site.baseurl }}/assets/2015/02/IC755473.png" style="border:0;" title="Business Process Flow Objects" /></font></p>
<div style="color:rgb(42,42,42);line-height:18px;padding-bottom:15px;"></div>
<p><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">Stages can be associated with specific related entities, so a business process flow can span multiple entities. The business process remains the same and leads the user to a desired conclusion. More information: <a href="http://technet.microsoft.com/en-us/library/dn531164(v=crm.7).aspx" style="color:rgb(3,105,122);text-decoration:none;">Customization Guide topic: Business Process Flows<br /></a></font><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">Actions that can be automated<br /></font><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">Normally, progressing along the business process depends on user input. As a developer, you can perform the same actions programmatically in form scripts.<br /></font><b style="color:rgb(42,42,42);"><font face="Arial, Helvetica, sans-serif" size="2">Change the process when there are more than one process available for the entity.<br /></font></b><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">Use <b>Xrm.Page.data.process.</b><a href="http://msdn.microsoft.com/en-us/library/6b79eb8c-8293-4d3a-a3a7-ea35157cde37#BKMK_getEnabledProcesses" style="color:rgb(3,105,122);text-decoration:none;">getEnabledProcesses</a> to retrieve information about enabled processes that the user can choose for the entity. Then use<b>Xrm.Page.data.process.</b><a href="http://msdn.microsoft.com/en-us/library/6b79eb8c-8293-4d3a-a3a7-ea35157cde37#BKMK_setActiveProcess" style="color:rgb(3,105,122);text-decoration:none;">setActiveProcess</a> to make one of the enabled processes the active one.</font>
<div style="color:rgb(42,42,42);line-height:18px;padding-bottom:15px;"></div>
<p><b style="color:rgb(42,42,42);"><font face="Arial, Helvetica, sans-serif" size="2">Move to the next stage when all required steps are completed to make it the current active stage.<br /></font></b><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">Use <b>Xrm.Page.data.process.</b><a href="http://msdn.microsoft.com/en-us/library/6b79eb8c-8293-4d3a-a3a7-ea35157cde37#BKMK_moveNext" style="color:rgb(3,105,122);text-decoration:none;">moveNext</a>.</font>
<div style="color:rgb(42,42,42);line-height:18px;padding-bottom:15px;"></div>
<p><b style="color:rgb(42,42,42);"><font face="Arial, Helvetica, sans-serif" size="2">Move to the previous stage and make it the current active stage.<br /></font></b><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">Use <b>Xrm.Page.data.process.</b><a href="http://msdn.microsoft.com/en-us/library/6b79eb8c-8293-4d3a-a3a7-ea35157cde37#BKMK_movePrevious" style="color:rgb(3,105,122);text-decoration:none;">movePrevious</a>.</font>
<div style="color:rgb(42,42,42);line-height:18px;padding-bottom:15px;"></div>
<p><b style="color:rgb(42,42,42);"><font face="Arial, Helvetica, sans-serif" size="2">Select a stage to view the status of the steps in the stage.<br /></font></b><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">Use <b>Xrm.Page.data.process.</b><a href="http://msdn.microsoft.com/en-us/library/6b79eb8c-8293-4d3a-a3a7-ea35157cde37#BKMK_getActivePath" style="color:rgb(3,105,122);text-decoration:none;">getActivePath</a> to retrieve information about the stages that have been completed, the current active stage, and valid stages available from the current active stage. Examine the steps included in that stage and compare the corresponding form attribute values to determine whether they are completed.</font>
<div style="color:rgb(42,42,42);line-height:18px;padding-bottom:15px;"></div>
<p><b style="color:rgb(42,42,42);"><font face="Arial, Helvetica, sans-serif" size="2">Complete a step<br /></font></b><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">Steps are completed when the corresponding data in the form is entered. You can determine the attribute using the step <a href="http://msdn.microsoft.com/en-us/library/6b79eb8c-8293-4d3a-a3a7-ea35157cde37#BKMK_step_getAttribute" style="color:rgb(3,105,122);text-decoration:none;">getAttribute</a> method. This will return the logical name of the attribute. Then use <b>Xrm.Page.getAttribute</b> to retrieve attribute from the <b>Xrm.Page.data.entity.attributes</b> collection and then use the attribute <a href="http://msdn.microsoft.com/en-us/library/6881e99b-45e4-4552-8355-2eef296f2cd8#BKMK_setValue" style="color:rgb(3,105,122);text-decoration:none;">setValue</a>method to set the value.</font>
<div style="color:rgb(42,42,42);line-height:18px;padding-bottom:15px;"></div>
<p><b style="color:rgb(42,42,42);"><font face="Arial, Helvetica, sans-serif" size="2">Detect whether a step is required<br /></font></b><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">Use the step <a href="http://msdn.microsoft.com/en-us/library/6b79eb8c-8293-4d3a-a3a7-ea35157cde37#BKMK_step_isRequired" style="color:rgb(3,105,122);text-decoration:none;">isRequired</a> method to determine if a step is required by the business process flow.</font>
<div style="color:rgb(42,42,42);line-height:18px;padding-bottom:15px;"></div>
<p><b style="color:rgb(42,42,42);"><font face="Arial, Helvetica, sans-serif" size="2">Expand or collapse the business process flow control<br /></font></b><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">Use <b>Xrm.Page.ui.process.</b><a href="http://msdn.microsoft.com/en-us/library/1468bab0-f6b3-4320-a60c-a88c9d4fcf1f#BKMK_setDisplayState" style="color:rgb(3,105,122);text-decoration:none;">setDisplayState</a>.</font>
<div style="color:rgb(42,42,42);line-height:18px;padding-bottom:15px;"></div>
<p><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">There are also some things you can do as a developer that a user cannot perform.<br /></font><b style="color:rgb(42,42,42);"><font face="Arial, Helvetica, sans-serif" size="2">Hide the process control<br /></font></b><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">Use <b>Xrm.Page.ui.process.</b><a href="http://msdn.microsoft.com/en-us/library/1468bab0-f6b3-4320-a60c-a88c9d4fcf1f#BKMK_setVisible" style="color:rgb(3,105,122);text-decoration:none;">setVisible</a>, you can control whether to display the business process flow control.</font>
<div style="color:rgb(42,42,42);line-height:18px;padding-bottom:15px;"></div>
<p><b style="color:rgb(42,42,42);"><font face="Arial, Helvetica, sans-serif" size="2">Skip to a valid completed stage.<br /></font></b><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">Use <b>Xrm.Page.data.process</b>.<a href="http://msdn.microsoft.com/en-us/library/6b79eb8c-8293-4d3a-a3a7-ea35157cde37#BKMK_setActiveStage" style="color:rgb(3,105,122);text-decoration:none;">setActiveStage</a> to set one of the valid completed stages for the current entity.</font>
<div style="color:rgb(42,42,42);line-height:18px;padding-bottom:15px;"></div>
<p><b style="color:rgb(42,42,42);"><font face="Arial, Helvetica, sans-serif" size="2">Query the process definition including stages not currently visible<br /></font></b><font face="Arial, Helvetica, sans-serif" size="2" style="color:rgb(42,42,42);">Use <b>Xrm.Page.data.process</b>.<a href="http://msdn.microsoft.com/en-us/library/6b79eb8c-8293-4d3a-a3a7-ea35157cde37#BKMK_getActiveProcess" style="color:rgb(3,105,122);text-decoration:none;">getActiveProcess</a> to query the definition of the business process flow, including stages that might not be visible because of branching logic in the process.</font>
<div style="color:rgb(42,42,42);line-height:18px;padding-bottom:15px;"></div>
<p><font face="Arial, Helvetica, sans-serif" size="2">Events for business process flows</font></p>
<div style="line-height:18px;padding-bottom:15px;"><font face="Arial, Helvetica, sans-serif" size="2"><span style="line-height:17.55px;"></span></font></div>
<p><font face="Arial, Helvetica, sans-serif" size="2">You can interact any event provided by the form with business process flows, but two new events allow you to execute code based on events just for the business process flow control. You can execute code when the active stage of a business process flow changes (<a href="http://msdn.microsoft.com/en-us/library/d88d5f21-6385-443b-91f2-0ec0c16b1324#BKMK_OnStageChange" style="text-decoration:none;">OnStageChange event</a>) or when a stage is selected (<a href="http://msdn.microsoft.com/en-us/library/d88d5f21-6385-443b-91f2-0ec0c16b1324#BKMK_OnStageSelected" style="text-decoration:none;">OnStageSelected event</a>).</font><br /><font face="Arial, Helvetica, sans-serif" size="2">Neither of these new events provide a user interface to register your event handlers. You must use methods provided to add or remove handlers for these events in the form<b>OnLoad</b> event.. More information: <a href="http://msdn.microsoft.com/en-us/library/f451f339-bcee-4260-9904-abc8c0efa153#BKMK_BPFControl" style="text-decoration:none;">Business Process Flow control events</a></font></p>
<div style="color:rgb(42,42,42);line-height:18px;padding-bottom:15px;"><font face="Arial, Helvetica, sans-serif" size="2"><span style="color:black;line-height:17.55px;"></span></font></div></p>
<div style="color:rgb(42,42,42);line-height:18px;padding-bottom:15px;"><font face="Arial, Helvetica, sans-serif" size="2"><a href="https://www.blogger.com/null" id="BKMK_Actions" style="color:rgb(19,100,196);line-height:17.55px;"></a><span style="color:black;line-height:17.55px;"></span><a href="https://www.blogger.com/null" id="BKMK_events" style="color:rgb(19,100,196);line-height:17.55px;"></a><span style="color:black;line-height:17.55px;"></span></font></div>
</div>
</div>
</div>
