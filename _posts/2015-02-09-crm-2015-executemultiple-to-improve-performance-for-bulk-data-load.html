---
layout: post
title: CRM 2015 - ExecuteMultiple to improve performance for bulk data load
date: 2015-02-09 11:29:00.000000000 +00:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- CRM 2015
tags:
- Execute vs ExecuteMultiple
meta:
  _publicize_pending: '1'
  sharing_disabled: '1'
  _import_session_id: 61e12c43ccaa7
  _import_original_post_id: '54027'
author:
  login: pedroairo
  email: pedroairo@dynamicsmonster.com
  display_name: pedroairo
  first_name: ''
  last_name: ''
permalink: "/2015/02/09/crm-2015-executemultiple-to-improve-performance-for-bulk-data-load/"
---
<div>
<div>
<div>
<p style="line-height:18px;padding-bottom:15px;color:rgb(42,42,42);"><font size="2">Sometimes we need to do some bulk import, in here i don't want to discuss what approach is better to use, Custom Code? Third Party Applications, SSIS,.. what i want to show in here is that from some tests i have done on importing lots of records is that much more the records to create, until reach the maximum possible (for this please go to the link at the end of the post), the time taken from the two ways that i tested is more visible.</font><font size="2"><br /></font><font size="2">In terms of that, i put in here 3 tests and the results (rough values):<br /></font><font size="2">100 Records<br /></font><font size="2">Execute :20.000 ms<br /></font><font size="2">ExecuteMultipleRequest: 16.000ms</font><font size="2"><br /></font><font size="2">Something around 23% more time.</font><font size="2"><br /></font><font size="2">500 Records<br /></font><font size="2">Execute :92.000 ms<br /></font><font size="2">ExecuteMultipleRequest: 73.500ms</font><font size="2"><br /></font><font size="2">Something around 25% more time.</font><font size="2"><br /></font><font size="2">1000 Records<br /></font><font size="2">Execute :180.000 ms<br /></font><font size="2">ExecuteMultipleRequest: 142.500ms</font><font size="2"><br /></font><span style="line-height:normal;color:black;"><font size="2">Something around 26% more time.</font></span></p>
<div>
<div style="font-family:'Segoe UI' , 'Lucida Grande' , Verdana , Arial , Helvetica , sans-serif;font-size:13px;line-height:18px;padding-bottom:15px;color:rgb(42,42,42);"><span style="font-family:Verdana , sans-serif;font-size:small;line-height:normal;color:black;"><br /></span></div>
<p style="overflow:auto;padding:5px;line-height:17.55px;"><font face="Arial, Helvetica, sans-serif" size="2">Applies To: CRM 2015 on-prem, CRM Online</font></p>
<div style="line-height:18px;padding-bottom:15px;color:rgb(42,42,42);"></div>
<p><font face="Arial, Helvetica, sans-serif" size="2">You can use the <a href="https://msdn.microsoft.com/en-us/library/microsoft.xrm.sdk.messages.executemultiplerequest.aspx" style="text-decoration:none;color:rgb(3,105,122);">ExecuteMultipleRequest</a> message to support higher throughput bulk message passing scenarios in Microsoft Dynamics CRM 2015 and Microsoft Dynamics CRM Online 2015 Update, particularly in the case of Microsoft Dynamics CRM Online where Internet latency can be the largest limiting factor. <a href="https://msdn.microsoft.com/en-us/library/microsoft.xrm.sdk.messages.executemultiplerequest.aspx" style="text-decoration:none;color:rgb(3,105,122);">ExecuteMultipleRequest</a> accepts an input collection of message <a href="https://msdn.microsoft.com/en-us/library/microsoft.xrm.sdk.messages.executemultiplerequest.requests.aspx" style="text-decoration:none;color:rgb(3,105,122);">Requests</a>, executes each of the message requests in the order they appear in the input collection, and optionally returns a collection of <a href="https://msdn.microsoft.com/en-us/library/microsoft.xrm.sdk.messages.executemultipleresponse.responses.aspx" style="text-decoration:none;color:rgb(3,105,122);">Responses</a> containing each message’s response or the error that occurred. Each message request in the input collection is processed in a separate database transaction. <a href="https://msdn.microsoft.com/en-us/library/microsoft.xrm.sdk.messages.executemultiplerequest.aspx" style="text-decoration:none;color:rgb(3,105,122);">ExecuteMultipleRequest</a> is executed by using the <a href="https://msdn.microsoft.com/en-us/library/microsoft.xrm.sdk.iorganizationservice.aspx" style="text-decoration:none;color:rgb(3,105,122);">IOrganizationService</a>.<a href="https://msdn.microsoft.com/en-us/library/microsoft.xrm.sdk.iorganizationservice.execute.aspx" style="text-decoration:none;color:rgb(3,105,122);">Execute</a> method.<br /></font><font face="Arial, Helvetica, sans-serif" size="2">In general, <a href="https://msdn.microsoft.com/en-us/library/microsoft.xrm.sdk.messages.executemultiplerequest.aspx" style="text-decoration:none;color:rgb(3,105,122);">ExecuteMultipleRequest</a> behaves the same as if you executed each message request in the input request collection separately, except with better performance. Use of the <a href="https://msdn.microsoft.com/en-us/library/microsoft.xrm.sdk.client.organizationserviceproxy.callerid.aspx" style="text-decoration:none;color:rgb(3,105,122);">CallerId</a> parameter of the service proxy is honored and will apply to the execution of every message in the input request collection. Plug-ins and workflow activities are executed as you would expect for each message processed.<br /></font><font face="Arial, Helvetica, sans-serif" size="2">Custom code in the form of plug-ins and custom workflow activities can even execute <a href="https://msdn.microsoft.com/en-us/library/microsoft.xrm.sdk.messages.executemultiplerequest.aspx" style="text-decoration:none;color:rgb(3,105,122);">ExecuteMultipleRequest</a>. However, there are a few key points to keep in mind. An exception thrown by a synchronous registered plug-in is returned in the response collection item <a href="https://msdn.microsoft.com/en-us/library/microsoft.xrm.sdk.executemultipleresponseitem.fault.aspx" style="text-decoration:none;color:rgb(3,105,122);">Fault</a> parameter. If a plug-in executes within a database transaction, the plug-in executes <a href="https://msdn.microsoft.com/en-us/library/microsoft.xrm.sdk.messages.executemultiplerequest.aspx" style="text-decoration:none;color:rgb(3,105,122);">ExecuteMultipleRequest</a>, and a transaction rollback is initiated, the rollback includes any data changes resulting from requests executed by <a href="https://msdn.microsoft.com/en-us/library/microsoft.xrm.sdk.messages.executemultiplerequest.aspx" style="text-decoration:none;color:rgb(3,105,122);">ExecuteMultipleRequest</a>.<br /></font><font face="Arial, Helvetica, sans-serif" size="2">The code from the CRM SDk.<br /></font><font face="Arial, Helvetica, sans-serif" size="2"><span style="color:green;">// Get a reference to the organization service.<br /></span></font><font face="Arial, Helvetica, sans-serif" size="2"><span style="color:blue;">using</span> (_serviceProxy = <span style="color:blue;">new</span> OrganizationServiceProxy(serverConfig.OrganizationUri, serverConfig.HomeRealmUri,serverConfig.Credentials, serverConfig.DeviceCredentials))<br /></font><font face="Arial, Helvetica, sans-serif" size="2">{<br /></font><font face="Arial, Helvetica, sans-serif" size="2"><span style="color:green;">// Enable early-bound type support to add/update entity records required for this sample.<br /></span></font><font face="Arial, Helvetica, sans-serif" size="2"> _serviceProxy.EnableProxyTypes();</font><font face="Arial, Helvetica, sans-serif" size="2"><br /></font><font face="Arial, Helvetica, sans-serif" size="2"><span style="color:blue;">#region</span> Execute Multiple with Results<br /></font><font face="Arial, Helvetica, sans-serif" size="2"><span style="color:green;">// Create an ExecuteMultipleRequest object.<br /></span></font><font face="Arial, Helvetica, sans-serif" size="2"> requestWithResults = <span style="color:blue;">new</span> ExecuteMultipleRequest()<br /></font><font face="Arial, Helvetica, sans-serif" size="2"> {<br /></font><font face="Arial, Helvetica, sans-serif" size="2"><span style="color:green;">// Assign settings that define execution behavior: continue on error, return responses.<br /> </span></font><font face="Arial, Helvetica, sans-serif" size="2"> Settings = <span style="color:blue;">new</span> ExecuteMultipleSettings()<br /></font><font face="Arial, Helvetica, sans-serif" size="2"> {<br /></font><font face="Arial, Helvetica, sans-serif" size="2"> ContinueOnError = <span style="color:blue;">false</span>,<br /></font><font face="Arial, Helvetica, sans-serif" size="2"> ReturnResponses = <span style="color:blue;">true<br /></span></font><font face="Arial, Helvetica, sans-serif" size="2"> },<br /></font><font face="Arial, Helvetica, sans-serif" size="2"><span style="color:green;">// Create an empty organization request collection.<br /></span></font><font face="Arial, Helvetica, sans-serif" size="2"> Requests = <span style="color:blue;">new</span> OrganizationRequestCollection()<br /></font><font face="Arial, Helvetica, sans-serif" size="2"> };</font><font face="Arial, Helvetica, sans-serif" size="2"><br /></font><font face="Arial, Helvetica, sans-serif" size="2"><span style="color:green;">// Create several (local, in memory) entities in a collection.<br /> </span></font><font face="Arial, Helvetica, sans-serif" size="2"> EntityCollection input = GetCollectionOfEntitiesToCreate();</font><font face="Arial, Helvetica, sans-serif" size="2"><br /></font><font face="Arial, Helvetica, sans-serif" size="2"><span style="color:green;">// Add a CreateRequest for each entity to the request collection.<br /></span></font><font face="Arial, Helvetica, sans-serif" size="2"><span style="color:blue;">foreach</span> (<span style="color:blue;">var</span> entity <span style="color:blue;">in</span> input.Entities)<br /></font><font face="Arial, Helvetica, sans-serif" size="2"> {<br /></font><font face="Arial, Helvetica, sans-serif" size="2"> CreateRequest createRequest = <span style="color:blue;">new</span> CreateRequest { Target = entity };<br /></font><font face="Arial, Helvetica, sans-serif" size="2"> requestWithResults.Requests.Add(createRequest);<br /></font><font face="Arial, Helvetica, sans-serif" size="2"> }</font><font face="Arial, Helvetica, sans-serif" size="2"><br /></font><font face="Arial, Helvetica, sans-serif" size="2"><span style="color:green;">// Execute all the requests in the request collection using a single web method call.<br /></span></font><font face="Arial, Helvetica, sans-serif" size="2"> ExecuteMultipleResponse responseWithResults =<br /></font><font face="Arial, Helvetica, sans-serif" size="2"> (ExecuteMultipleResponse)_serviceProxy.Execute(requestWithResults);</font><font face="Arial, Helvetica, sans-serif" size="2"><br /></font><font face="Arial, Helvetica, sans-serif" size="2"><span style="color:green;">// Display the results returned in the responses.<br /></span></font><font face="Arial, Helvetica, sans-serif" size="2"><span style="color:blue;">foreach</span> (<span style="color:blue;">var</span> responseItem <span style="color:blue;">in</span> responseWithResults.Responses)<br /></font><font face="Arial, Helvetica, sans-serif" size="2"> {<br /></font><font face="Arial, Helvetica, sans-serif" size="2"><span style="color:green;">// A valid response.<br /></span></font><font face="Arial, Helvetica, sans-serif" size="2"><span style="color:blue;">if</span> (responseItem.Response != <span style="color:blue;">null</span>)<br /></font><font face="Arial, Helvetica, sans-serif" size="2"> DisplayResponse(requestWithResults.Requests, responseItem.Response);</font><font face="Arial, Helvetica, sans-serif" size="2"><br /></font><font face="Arial, Helvetica, sans-serif" size="2"><span style="color:green;">// An error has occurred.<br /></span></font><font face="Arial, Helvetica, sans-serif" size="2"><span style="color:blue;">else</span> <span style="color:blue;">if</span> (responseItem.Fault != <span style="color:blue;">null</span>)<br /></font><font face="Arial, Helvetica, sans-serif" size="2"> DisplayFault(requestWithResults.Requests,<br /> </font><font face="Arial, Helvetica, sans-serif" size="2"> responseItem.RequestIndex, responseItem.Fault);<br /></font><font face="Arial, Helvetica, sans-serif" size="2"> }</font></p>
<div id="mainSection" style="clear:both;">
<div id="mainBody">
<pre style="font-size:13px;line-height:17.55px;overflow:auto;padding:5px;font-family:Consolas , Courier , monospace;"><br /></pre>
<p style="overflow:auto;padding:5px;line-height:17.55px;"><font face="Verdana, Geneva, sans-serif" size="2">Link to the Microsoft Site:</font></p>
<p style="overflow:auto;padding:5px;line-height:17.55px;"><font face="Verdana, Geneva, sans-serif" size="2"><a href="https://msdn.microsoft.com/en-us/library/jj863631.aspx" target="on" title="https://msdn.microsoft.com/en-us/library/jj863631.aspx">https://msdn.microsoft.com/en-us/library/jj863631.aspx</a> <br /></font></p>
</div>
</div>
</div>
</div>
</div>
</div>
