---
layout: post
title: Execute a CRM(2011/2013) OnPremesis or Online Workflow from Javascript
date: 2014-04-29 14:54:00.000000000 +00:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories: []
tags:
- CRM 2011
- CRM 2013
- Execute
- Javascript
- Workflow
meta:
  _publicize_pending: '1'
  sharing_disabled: '1'
  _import_session_id: 61e12c43ccaa7
  _import_original_post_id: '54085'
author:
  login: pedroairo
  email: pedroairo@dynamicsmonster.com
  display_name: pedroairo
  first_name: ''
  last_name: ''
permalink: "/2014/04/29/execute-crm20112013-onpremesis-or/"
---
<div>
<div>
<div><span style="font-family:Verdana, sans-serif;font-size:x-small;"><br />The function below can be used to execute a workflow from&nbsp;JavaScript&nbsp;using the Organization.svc service&nbsp;instead of the CrmService.asmx from previous versions (CRM 3.0 and CRM4.0 versions):</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;"><br />The first parameter of the function is the workflowid that it will be called, and the second parameter is only to show or not a window to confirm the action that will be made in next:</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;"><br /></span><span style="font-family:Verdana, sans-serif;font-size:x-small;"><br /></span><span style="font-family:Verdana, sans-serif;font-size:x-small;">function ExecuteWorkflow(workflowId, confirmQuestion)</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">{</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; var _return = true;</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; if(confirmQuestion)</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; _return = window.confirm('Are you want to execute workflow.');</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;"><br /></span><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; if (_return) {</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; var url = Xrm.Page.context.getServerUrl();</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; var entityId = Xrm.Page.data.entity.getId();</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; var OrgServicePath = "/XRMServices/2011/Organization.svc/web";</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; url = url + OrgServicePath;</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; var request;</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; request = "&lt;s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;s:Body&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;Execute xmlns="http://schemas.microsoft.com/xrm/2011/Contracts/Services" xmlns:i="http://www.w3.org/2001/XMLSchema-instance"&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;request i:type="b:ExecuteWorkflowRequest" xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts" xmlns:b="http://schemas.microsoft.com/crm/2011/Contracts"&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;a:Parameters xmlns:c="http://schemas.datacontract.org/2004/07/System.Collections.Generic"&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;a:KeyValuePairOfstringanyType&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;c:key&gt;EntityId&lt;/c:key&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;c:value i:type="d:guid" xmlns:d="http://schemas.microsoft.com/2003/10/Serialization/"&gt;" + entityId + "&lt;/c:value&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;/a:KeyValuePairOfstringanyType&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;a:KeyValuePairOfstringanyType&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;c:key&gt;WorkflowId&lt;/c:key&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;c:value i:type="d:guid" xmlns:d="http://schemas.microsoft.com/2003/10/Serialization/"&gt;" + workflowId + "&lt;/c:value&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;/a:KeyValuePairOfstringanyType&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;/a:Parameters&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;a:RequestId i:nil="true" /&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;a:RequestName&gt;ExecuteWorkflow&lt;/a:RequestName&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;/request&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;/Execute&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;/s:Body&gt;" +</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "&lt;/s:Envelope&gt;";</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;"><br /></span><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; var req = new XMLHttpRequest();</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; req.open("POST", url, true)</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; // Responses will return XML. It isn't possible to return JSON.</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; req.setRequestHeader("Accept", "application/xml, text/xml, */*");</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; req.setRequestHeader("Content-Type", "text/xml; charset=utf-8");</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; req.setRequestHeader("SOAPAction", "http://schemas.microsoft.com/xrm/2011/Contracts/Services/IOrganizationService/Execute");</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; req.onreadystatechange = function () { assignResponse(req); };</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; req.send(request);</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; }</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">}</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;"><br /></span><span style="font-family:Verdana, sans-serif;font-size:x-small;">function assignResponse(req) {</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; if (req.readyState == 4) {</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; if (req.status == 200) {</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alert('Successfully executed the workflow');</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; &nbsp; &nbsp; }</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">&nbsp; &nbsp; }</span><br /><span style="font-family:Verdana, sans-serif;font-size:x-small;">}</span></div>
</div>
</div>
